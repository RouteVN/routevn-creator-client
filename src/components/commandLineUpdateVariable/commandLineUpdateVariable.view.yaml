elementName: rvn-command-line-update-variable

propsSchema:
  type: object
  properties:
    updateVariable:
      type: object
      properties:
        id:
          type: string
        operations:
          type: array

viewDataSchema:
  type: object
  properties:
    initiated:
      type: boolean
    mode:
      type: string
    breadcrumb:
      type: array
    actionId:
      type: string
    operations:
      type: array
    variableOptions:
      type: array
    operationOptions:
      type: array
    booleanOptions:
      type: array
    showValueField:
      type: boolean
    valueInputType:
      type: string
    tempOperation:
      type: object
    dropdownMenu:
      type: object
    hasOperations:
      type: boolean
    canSaveOperation:
      type: boolean

refs:
  add-operation-button:
    eventListeners:
      click:
        handler: handleAddOperationClick
  operation-*:
    eventListeners:
      click:
        handler: handleOperationClick
      contextmenu:
        handler: handleOperationContextMenu
  submit-button:
    eventListeners:
      click:
        handler: handleSubmitClick
  save-operation-button:
    eventListeners:
      click:
        handler: handleSaveOperationClick
  breadcrumb:
    eventListeners:
      item-click:
        handler: handleBreadcrumbClick
  variable-select:
    eventListeners:
      option-selected:
        handler: handleVariableSelectChange
  operation-select:
    eventListeners:
      option-selected:
        handler: handleOperationSelectChange
  value-input:
    eventListeners:
      input:
        handler: handleValueInputChange
  boolean-select:
    eventListeners:
      option-selected:
        handler: handleBooleanSelectChange
  dropdown-menu:
    eventListeners:
      close:
        handler: handleDropdownMenuClose
      click-item:
        handler: handleDropdownMenuClickItem

template:
  - rtgl-view w=f h=f p=lg:
      - $if mode == 'current' && initiated:
          - rtgl-view d=h g=md:
              - rtgl-breadcrumb#breadcrumb .items=breadcrumb:
          - rtgl-view g=md mt=md w=f:
              - $for operation in operations:
                  - rtgl-view#operation-${operation.id} cur=p d=h av=c ah=c g=md p=md bgc=mu h-bgc=ac br=md w=f:
                      - rtgl-text s=sm: "${operation.variableName}:"
                      - rtgl-text s=sm c=pr: "${operation.opLabel}"
                      - $if operation.op != 'toggle':
                          - rtgl-text s=sm: "${operation.displayValue}"
              - rtgl-button#add-operation-button v=ol w=f mt=md: + Add Operation
          - rtgl-view flex=1:
          - rtgl-view d=h av=c ah=e w=f g=lg:
              - rtgl-button#submit-button ?disabled=${!hasOperations}: Submit

      - $if mode == 'edit' && initiated:
          - rtgl-view d=h g=md:
              - rtgl-breadcrumb#breadcrumb .items=breadcrumb:
          - rtgl-view g=md mt=md w=f:
              - rtgl-text s=sm c=mu-fg mb=sm: Variable
              - rtgl-select#variable-select w=f .selectedValue=tempOperation.variableId .options=variableOptions placeholder="Choose a variable...":

              - $if tempOperation.variableId:
                  - rtgl-text s=sm c=mu-fg mt=lg mb=sm: Operation
                  - rtgl-select#operation-select w=f .selectedValue=tempOperation.op .options=operationOptions placeholder="Choose an operation...":

              - $if showValueField && valueInputType == 'number':
                  - rtgl-text s=sm c=mu-fg mt=lg mb=sm: Value
                  - rtgl-input#value-input type=number w=f placeholder="Enter number..." value=${tempOperation.value}:

              - $if showValueField && valueInputType == 'boolean':
                  - rtgl-text s=sm c=mu-fg mt=lg mb=sm: Value
                  - rtgl-select#boolean-select w=f .selectedValue=tempOperation.booleanValue .options=booleanOptions:

              - $if showValueField && valueInputType == 'string':
                  - rtgl-text s=sm c=mu-fg mt=lg mb=sm: Value
                  - rtgl-input#value-input w=f placeholder="Enter text..." value=${tempOperation.value}:

          - rtgl-view flex=1:
          - rtgl-view d=h av=c ah=e w=f g=lg:
              - rtgl-button#save-operation-button ?disabled=${!canSaveOperation}: Save Operation

  - rtgl-dropdown-menu#dropdown-menu .items=dropdownMenu.items x=${dropdownMenu.position.x} y=${dropdownMenu.position.y} ?open=${dropdownMenu.isOpen}:
