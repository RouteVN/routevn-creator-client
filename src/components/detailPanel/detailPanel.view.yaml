

elementName: rvn-detail-panel

propsSchema:
  type: object
  properties:
    title:
      type: string
    fields:
      type: array
      items:
        type: object
        properties:
          type:
            type: string
          editable:
            type: boolean
            description: Whether the field is editable (for images, enables click-to-upload)
          key:
            type: string
            description: Unique key for the field to force re-rendering when changed
    emptyMessage:
      type: string

refs:
  editable-image-*:
    eventListeners:
      click:
        handler: handleEditableImageClick
  file-input-*:
    eventListeners:
      change:
        handler: handleFileInputChange
  editable-audio-*:
    eventListeners:
      click:
        handler: handleEditableAudioClick
  title-text-*:
    eventListeners:
      click:
        handler: handleTitleClick
  color-field-*:
    eventListeners:
      click:
        handler: handleColorFieldClick
  font-field-*:
    eventListeners:
      click:
        handler: handleFontFieldClick
  typography-field-*:
    eventListeners:
      click:
        handler: handleTypographyFieldClick
  popover:
    eventListeners:
      click-overlay:
        handler: handlePopoverClickOverlay
  form:
    eventListeners:
      action-click:
        handler: handleFormActionClick
  color-dialog:
    eventListeners:
      close-dialogue:
        handler: handleCloseColorDialog
  color-form:
    eventListeners:
      action-click:
        handler: handleColorFormActionClick
  typography-dialog:
    eventListeners:
      close-dialogue:
        handler: handleCloseTypographyDialog
  typography-form:
    eventListeners:
      action-click:
        handler: handleTypographyFormActionClick

template:
  - rtgl-view w=f h=f p=md w=270 bwl=xs bc=bo:
    - $if hasContent:
        - $if title:
            - rtgl-text s=lg: ${title}
        - rtgl-view w=f h=f g=md:
          - $for field, i in visibleFields:
              - $if field.type == 'image':
                  - $if field.editable:
                      - rtgl-view pos=rel:
                        - 'rtgl-view#editable-image-${i} cur=p style="position: relative;"':
                          - rvn-file-image br=md w=${field.width} h=${field.height} fileId=${field.fileId} key=${field.fileId}:
                        - 'input#file-input-${i} type=file accept="${field.accept}" style="display: none;"':
                    $else:
                      - rvn-file-image br=md w=${field.width} h=${field.height} fileId=${field.fileId} key=${field.fileId}:
                $elif field.type == 'text':
                  - rtgl-view:
                    - rtgl-text c=mu-fg: ${field.label}
                    - $if field.editable:
                        - 'rtgl-view#editable-text-${i} cur=p':
                          - rtgl-text s=${field.size}: ${field.value}
                      $elif i == firstTextIndex:
                        - rtgl-text#title-text-${i} s=${field.size} cur=p: ${field.value}
                      $else:
                        - rtgl-text s=${field.size}: ${field.value}
                $elif field.type == 'color':
                  - rtgl-view:
                    - 'rtgl-view#color-field-${i} w=200 h=150 br=md cur=p style="background-color: ${field.value}"':
                $elif field.type == 'font':
                  - rtgl-view:
                    - 'rtgl-view#font-field-${i} w=200 h=150 av=c ah=c bgc=bg bc=bo bw=xs br=md cur=p':
                      - 'rtgl-text style="font-family: ${field.fontFamily}, sans-serif; font-size: 60px; text-align: center;"': ${field.previewText}
                    - 'input#file-input-${i} type=file accept=".ttf,.otf,.woff,.woff2" style="display: none;"':
                $elif field.type == 'typography':
                  - rtgl-view:
                    - 'rtgl-view#typography-field-${i} w=240 h=80 av=c ah=c bgc=bg bc=bo bw=xs br=md cur=p style="color: ${field.fontColor}; font-size: ${field.fontSize}px; font-weight: ${field.fontWeight};"':
                      - rtgl-text: ${field.name}
                $elif field.type == 'audio':
                  - $if field.editable:
                      - rtgl-view pos=rel:
                        - 'rtgl-view#editable-audio-${i} cur=p style="position: relative;"':
                          - rvn-waveform-visualizer waveformDataFileId=${field.waveformDataFileId} width=270 height=180 key=${field.waveformDataFileId}:
                        - 'input#file-input-${i} type=file accept="${field.accept}" style="display: none;"':
                    $else:
                      - rvn-waveform-visualizer waveformDataFileId=${field.waveformDataFileId} width=270 height=180:
      $else:
        - rtgl-view w=f h=f av=c ah=c:
          - rtgl-text c=mu-fg s=lg ta=c: ${emptyMessage}
  - rtgl-popover#popover .isOpen=popover.isOpen .position=popover.position:
    - $if form:
        - rtgl-form#form slot=content .form=form:
  
  - rtgl-dialog#color-dialog .isOpen=colorDialog.isOpen:
    - rtgl-view slot=content g=md:
      - rtgl-form#color-form .defaultValues=colorDialog.defaultValues .form=colorDialog.form w=f:
  
  - rtgl-dialog#typography-dialog .isOpen=typographyDialog.isOpen:
    - rtgl-view slot=content g=md:
      - rtgl-form#typography-form .defaultValues=typographyDialog.defaultValues .form=typographyDialog.form w=f: