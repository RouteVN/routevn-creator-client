elementName: rvn-system-actions

propsSchema:
  type: object
  properties:
    actions:
      type: object
    selectedLineId:
      type: string
    selectedLine:
      type: object
    currentSceneId:
      type: string
    presentationState:
      type: object

refs:
  command-line-*:
    eventListeners:
      back-to-actions:
        handler: handleBackToActions
      actionClicked:
        handler: handleActionClicked
      submit:
        handler: handleCommandLineSubmit
  add-action-button:
    eventListeners:
      click:
        handler: handleAddActionButtonClicked
  actions-dialog:
    eventListeners:
      close:
        handler: handleActionsDialogClose
  action-item-*:
    eventListeners:
      click:
        handler: handleActionItemClick
      contextmenu:
        handler: handleActionItemRightClick
  dropdown-menu:
    eventListeners:
      close:
        handler: handleDropdownMenuClose
      click-item:
        handler: handleDropdownMenuClickItem

template:
  - $if showSelected:
      - rtgl-view g=md w=f:
          - $if preview.background || preview.bgm || preview.sfx || preview.character || preview.sectionTransition || preview.dialogue || preview.choice || preview.base || preview.nextLine:
              - $if preview.base:
                  - rtgl-view#action-item-base data-mode=base g=md d=h av=c ph=md bgc=mu h-bgc=ac br=md h=36 w=f cur=p:
                      - rtgl-svg svg=screen wh=24:
                      - rtgl-text s=sm: ${preview.base.name}
              - $if preview.background:
                  - rtgl-view#action-item-background data-mode=background g=md d=h av=c ph=md bgc=mu br=md h-bgc=ac h=36 w=f cur=p:
                      - rtgl-svg svg=image wh=24:
                      - rvn-file-image fileId=${preview.background.fileId} w=50 h=35:
                      - rtgl-text s=sm: ${preview.background.name}
              - $if preview.bgm:
                  - rtgl-view#action-item-bgm data-mode=bgm g=md d=h av=c ph=md bgc=mu h-bgc=ac br=md h=36 w=f cur=p:
                      - rtgl-svg svg=music wh=24:
                      - rtgl-text s=sm: ${preview.bgm.name}
              - $if preview.sfx:
                  - rtgl-view#action-item-sfx data-mode=sfx g=md d=h av=c ph=md bgc=mu h-bgc=ac br=md h=36 w=f cur=p:
                      - rtgl-svg svg=audio wh=24:
                      - rtgl-text s=sm: ${preview.sfx.names}
              - $if preview.character:
                  - rtgl-view#action-item-character data-mode=character g=md d=h av=c ph=md bgc=mu h-bgc=ac br=md h=36 w=f cur=p:
                      - rtgl-svg svg=character wh=24:
                      - rtgl-view d=h g=sm av=c:
                          - $for charData, i in preview.character:
                              - rvn-file-image fileId=${charData.sprite.fileId} w=32 h=32:
              - $if preview.sectionTransition:
                  - rtgl-view#action-item-sectionTransition data-mode=sectionTransition g=md d=h av=c ph=md bgc=mu h-bgc=ac br=md h=36 w=f cur=p:
                      - rtgl-svg svg="transition" wh=24:
                      - rtgl-text s=sm: "Transition to scene: ${preview.sectionTransition.scene.name} section: ${preview.sectionTransition.section.name}"
              - $if preview.dialogue:
                  - rtgl-view#action-item-dialogue data-mode=dialogue g=md d=h av=c ph=md bgc=mu h-bgc=ac br=md h=36 w=f cur=p:
                      - rtgl-svg svg=dialogue wh=24:
                      - rtgl-text s=sm: ${preview.dialogue.name}
              - $if preview.choice:
                  - rtgl-view#action-item-choices data-mode=choice g=md d=h av=c ph=md bgc=mu h-bgc=ac br=md w=f cur=p pv=md:
                      - rtgl-svg svg=choices wh=24:
                      - rtgl-view d=v:
                          - rtgl-text s=sm mb=sm: "${preview.choice.layout.name}"
                          - $for choice in preview.choice.items:
                              - rtgl-text s=xs c=mu-fg: "â€¢ ${choice.content}"
              - $if preview.nextLine:
                  - rtgl-view#action-item-nextLine data-mode=nextLine g=md d=h av=c ph=md bgc=mu h-bgc=ac br=md h=36 w=f cur=p:
                      - rtgl-svg svg="next-line" wh=24:
                      - rtgl-text s=sm: Next Line
            $else:
              - rtgl-text s=sm c=mu-fg: No actions added yet
          - rtgl-button#add-action-button v=ol w=f: +
  - rtgl-dialog#actions-dialog key=${mode} ?open=${isActionsDialogOpen}:
      - rtgl-view slot=content w=800 h=80vh:
          - $if mode == "actions":
              - rvn-command-line-actions#command-line-actions actions-type=${actionsType}:
            $elif mode == "dialogue":
              - rvn-command-line-dialogue-box#command-line-dialogue-box .layouts=dialogueLayouts .characters=allCharacters .dialogue=actions.dialogue:
            $elif mode == "choice":
              - rvn-command-line-choices#command-line-choices .layouts=choiceLayouts .choice=actions.choice:
            $elif mode == "background":
              - rvn-command-line-background#command-line-background data-mode="background" .background=actions.background:
            $elif mode == "bgm":
              - rvn-command-line-bgm#command-line-bgm .bgm=actions.bgm:
            $elif mode == "sfx":
              - rvn-command-line-sound-effects#command-line-sound-effects .sfx=actions.sfx:
            $elif mode == "character":
              - rvn-command-line-characters#command-line-characters .character=actions.character .presentationState=presentationState:
            $elif mode == "sectionTransition":
              - rvn-command-line-section-transition#command-line-section-transition .sectionTransition=actions.sectionTransition .currentSceneId=currentSceneId:
            $elif mode == "base":
              - rvn-command-line-base#command-line-base .layouts=baseLayouts .base=actions.base:
            $elif mode == "nextLine":
              - rvn-command-line-next-line#command-line-next-line .nextLine=selectedLine.actions.nextLine:
            $elif mode == "controls":
              - rvn-command-line-controls#command-line-controls .controls=selectedLine.controls:
  - rtgl-dropdown-menu#dropdown-menu .items=dropdownMenu.items x=${dropdownMenu.position.x} y=${dropdownMenu.position.y} ?open=${dropdownMenu.isOpen}:
