elementName: rvn-whiteboard

viewDataSchema:
  type: object
  properties:
    items:
      type: array
      items:
        type: object
        properties:
          id:
            type: string
          name:
            type: string
          x:
            type: number
          y:
            type: number
          borderColor:
            type: string
    selectedItemId:
      type: string
    isPanMode:
      type: boolean
    panX:
      type: number
    panY:
      type: number
    zoomLevel:
      type: number
    zoomLevelPercent:
      type: number
    containerCursor:
      type: string
    itemCursor:
      type: string

propsSchema:
  type: object
  properties:
    items:
      type: array
      items:
        type: object
        properties:
          id:
            type: string
          name:
            type: string
          x:
            type: number
          y:
            type: number
    initialZoomLevel:
      type: number
    cursor:
      type: string
    selectedItemId:
      type: string

refs:
  container:
    eventListeners:
      wheel:
        handler: handleContainerWheel
      mousedown:
        handler: handleContainerMouseDown
      contextmenu:
        handler: handleContainerContextMenu
  item-*:
    eventListeners:
      mousedown:
        required: true
        handler: handleItemMouseDown
      dblclick:
        handler: handleItemDoubleClick
      contextmenu:
        handler: handleItemContextMenu
  zoom-in-btn:
    eventListeners:
      click:
        handler: handleZoomInClick
  zoom-out-btn:
    eventListeners:
      click:
        handler: handleZoomOutClick
  pan-btn:
    eventListeners:
      click:
        handler: handlePanButtonClick

template:
  - 'rtgl-view#container w=f h=f pos=rel bgc=bg cur=${containerCursor} style="overflow: hidden; min-height: 400px; background-image: radial-gradient(circle, var(--input) 1px, transparent 1px); background-size: ${gridSize}px ${gridSize}px; background-position: ${panX}px ${panY}px;"':
      - 'rtgl-view#canvas w=f h=f pos=rel style="transform: translate(${panX}px, ${panY}px) scale(${zoomLevel}); transform-origin: 0 0; width: 0px; height: 0px;"':
          - $for item in items:
              - 'rtgl-view#item-${item.id} cur=${itemCursor} w=120 h=60 d=h ah=e av=c pos=abs style="left: ${item.x}px; top: ${item.y}px; z-index: 10; user-select: none;"':
                  - $if item.isInit == true:
                      - 'rtgl-view d=h av=c pos=abs style="left: -110px; top: 15px; z-index: 10; user-select: none;"':
                          - rtgl-view w=80 h=30 ah=c av=c p=md bgc=ac br=md bw=sm bc=${item.borderColor}:
                              - rtgl-text s=sm: "Start"
                          - rtgl-view w=30 h=2 bgc=${item.borderColor}:
                  - rtgl-view w=120 h=f av=c ah=c p=md bgc=mu bw=sm bc=${item.borderColor} br=md:
                      - rtgl-text s=sm: "${item.name}"
          - $for arrow in arrowsList:
            - svg#${arrow.id} style="${arrow.style}" width="${arrow.svgWidth}" height="${arrow.svgHeight}":
              - defs:
                - marker id="arrowhead" fill="#ccc" markerWidth=10 markerHeight=10 refX=10 refY=5 orient="auto":
                  - polygon points="0 0, 10 5, 0 10":
              - path d="${arrow.path}" stroke="#ccc" fill="none" z-index="1000" marker-end="url(#arrowhead)":
      - 'rtgl-view pos=abs z=100 ah=c p=md bgc=mu br=md style="right: 20px; bottom: 20px;"':
          - rtgl-view d=h av=c gap=sm:
              - rtgl-button#pan-btn sq icon=hand v=${panModeV}:
              - "rtgl-button#zoom-out-btn v=se s=md sq": "-"
              - "rtgl-view bgc=co p=sm br=full w=50 ah=c av=c":
                  - rtgl-text s=sm: "${zoomLevelPercent}%"
              - "rtgl-button#zoom-in-btn v=se s=md sq": "+"
