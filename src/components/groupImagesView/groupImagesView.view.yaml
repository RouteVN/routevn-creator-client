elementName: rvn-group-images-view

viewDataSchema:
  type: object
  properties:
    searchQuery:
      type: string
    zoomLevel:
      type: number
    imageHeight:
      type: number
    maxWidth:
      type: number
    fullImagePreviewVisible:
      type: boolean
    fullImagePreviewFileId:
      type: string

propsSchema:
  type: object
  properties:
    flatGroups:
      type: array
      description: Array of image groups to display
    selectedItemId:
      type: string
      description: ID of currently selected item

refs:
  search-input:
    eventListeners:
      input-change:
        handler: handleSearchInput
  zoom-slider:
    eventListeners:
      slider-change:
        handler: handleZoomChange
  zoom-out:
    eventListeners:
      click:
        handler: handleZoomOut
  zoom-in:
    eventListeners:
      click:
        handler: handleZoomIn
  drag-drop-item-*:
    eventListeners:
      file-selected:
        handler: handleDragDropFileSelected
  drag-drop-bar-*:
    eventListeners:
      file-selected:
        handler: handleDragDropFileSelected
  group-*:
    eventListeners:
      click:
        handler: handleGroupClick
  image-item-*:
    eventListeners:
      click:
        handler: handleImageItemClick
      dblclick:
        handler: handleImageDoubleClick
  preview-overlay:
    eventListeners:
      click:
        handler: handlePreviewOverlayClick

template:
  - 'rtgl-view w=f h=100vh g=lg style="overflow-y: scroll;"':
    - rtgl-view g=lg w=f:
      - 'rtgl-view h=48 w=f bgc=bg bwb=xs ph=md av=c style="position: sticky; top: 0px; z-index: 1000;"':
        - rtgl-view d=h av=c g=xl w=f:
          - 'rtgl-input#search-input s=sm pl=xl placeholder="Search images..." value=${searchQuery} style="border:none;"':
          - rtgl-view d=h av=c g=sm:
            - rtgl-button#zoom-out w=10 v="gh" s=sm: "-"
            - rtgl-slider#zoom-slider type="range" w=120 min="0.5" max="4.0" step="0.1" value="${zoomLevel}":
            - rtgl-button#zoom-in w=10 v="gh" s=sm: "+"
      - $if flatGroups.length > 0:
          - $for group in flatGroups:
            - rtgl-view w=f ph=md:
              - 'rtgl-view#group-${group.id} d=h w=f av=c bgc=bg cur=p style="position: sticky; top: 48px;"':
                - $if group.isCollapsed:
                    - rtgl-svg wh=16 svg=folderArrowRight:
                  $else:
                    - rtgl-svg wh=16 svg=folderArrowDown:
                - rtgl-view d=h av=c g=md:
                  - rtgl-svg wh=16 svg=folder:
                  - rtgl-text: ${group.fullLabel}
              - $if !group.isCollapsed:
                  - rtgl-view w=f mb=md p=sm:
                    - rtgl-view d=h fw=w g=md:
                      - $if group.hasChildren:
                          - $for item in group.children:
                              - 'rtgl-view#image-item-${item.id} cur=p style="${item.selectedStyle}"':
                                - rvn-file-image br=md mw=${maxWidth} h=${imageHeight} fileId=${item.fileId} key=${item.fileId}-${imageHeight}x${maxWidth}:
                          - rvn-drag-drop#drag-drop-item-${group.id} .uploadText=uploadText .acceptedFileTypes=acceptedFileTypes:
                        $else:
                          - rvn-drag-drop#drag-drop-item-${group.id} .uploadText=uploadText .acceptedFileTypes=acceptedFileTypes:
        $elif searchQuery:
          - rtgl-view w=f h=400 av=c ah=c:
            - rtgl-text s=lg c=mu-fg: No images found matching "${searchQuery}"
    - rtgl-view h=33vh:
  - $if fullImagePreviewVisible:
      - rtgl-view#preview-overlay pos=fix cor=full ah=c av=c z=3000 cur=p:
        - rtgl-view w=f h=f pos=fix cor=full ah=c av=c bgc=bg op="0.5":
        - $if fullImagePreviewFileId:
            - rvn-file-image fileId=${fullImagePreviewFileId} w=80% h=80% z=3001:
