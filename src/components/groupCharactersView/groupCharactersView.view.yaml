elementName: rvn-group-characters-view

viewDataSchema:
  type: object
  properties:
    searchQuery:
      type: string

propsSchema:
  type: object
  properties:
    flatGroups:
      type: array
      description: Array of character groups to display
    selectedItemId:
      type: string
      description: ID of currently selected item

refs:
  search-input:
    eventListeners:
      input-change:
        handler: handleSearchInput
  group-*:
    eventListeners:
      click:
        handler: handleGroupClick
  character-item-*:
    eventListeners:
      click:
        handler: handleCharacterItemClick
  sprites-button-*:
    eventListeners:
      click:
        handler: handleSpritesButtonClick
  add-character-button-*:
    eventListeners:
      click:
        handler: handleAddCharacterClick
  add-character-dialog:
    eventListeners:
      close:
        handler: handleCloseDialog
  character-form:
    eventListeners:
      action-click:
        handler: handleFormActionClick
  avatar-image:
    eventListeners:
      click:
        handler: handleAvatarClick
  avatar-placeholder:
    eventListeners:
      click:
        handler: handleAvatarClick

template:
  - 'rtgl-view w=f h=100vh g=lg style="overflow-y: scroll;"':
    - rtgl-view g=lg w=f h=f:
      - 'rtgl-view h=48 w=f bgc=bg bwb=xs ph=md av=c style="position: sticky; top: 0px; z-index: 1000;"':
        - rtgl-input#search-input s=sm placeholder="Search characters..." value=${searchQuery}:
        # TODO implment zoom controls (increase/decrease character size)
      - $if flatGroups.length > 0:
          - $for group in flatGroups:
            - rtgl-view w=f ph=md:
              - 'rtgl-view#group-${group.id} d=h w=f av=c bgc=bg cur=p style="position: sticky; top: 48px;"':
                - $if group.isCollapsed:
                    - rtgl-svg wh=16 svg=folderArrowRight:
                  $else:
                    - rtgl-svg wh=16 svg=folderArrowDown:
                - rtgl-view d=h av=c g=md:
                  - rtgl-svg wh=16 svg=folder:
                  - rtgl-text: ${group.fullLabel}
              - $if !group.isCollapsed:
                  - rtgl-view w=f mb=md p=sm:
                    - $if group.hasChildren:
                        - $for item in group.children:
                            - 'rtgl-view#character-item-${item.id} w=f d=h g=xl fw=w mt=lg bw=xs br=lg p=lg cur=p style="${item.selectedStyle}"':
                              - rvn-file-image w=96 h=96 br=f fileId=${item.fileId}:
                              - rtgl-view flex=1 g=md:
                                - rtgl-text s=h2: ${item.name}
                                - rtgl-text c=mu-fg: ${item.description}
                              - rtgl-view h=f av=c:
                                - rtgl-button#sprites-button-${item.id}: Sprites
                        - rtgl-view mt=lg w=f:
                          - 'rtgl-view#add-character-button-${group.id} w=f d=h av=c ah=c g=md p=lg bw=xs bc=bo br=lg cur=p':
                            - rtgl-svg wh=24 svg=plus c=pr:
                            - rtgl-text s=md c=pr fw=500: Add Character
                      $else:
                        - rtgl-view mt=lg w=f:
                          - 'rtgl-view#add-character-button-${group.id} w=f d=h av=c ah=c g=md p=lg bw=xs bc=bo br=lg cur=p':
                            - rtgl-svg wh=24 svg=plus c=pr:
                            - rtgl-text s=md c=pr fw=500: Add Character
        $elif searchQuery:
          - rtgl-view w=f h=400 av=c ah=c:
            - rtgl-text s=lg c=mu-fg: No characters found matching "${searchQuery}"
        $else:
          - rtgl-view w=f h=f av=c ah=c:
              - rtgl-text s=lg c=mu-fg: No data

              - rtgl-view h=64:

      - $if flatGroups.length > 0:
          - rtgl-view h=33vh:

  - rtgl-dialog#add-character-dialog ?open=${isDialogOpen} s=md:
    - rtgl-view slot=content g=md:
      - rtgl-form#character-form key=${isDialogOpen} .defaultValues=defaultValues .form=form w=f:
        - $if avatarFileId:
            - rvn-file-image#avatar-image fileId=${avatarFileId} wh=120 slot=avatar-slot cur=p br=md:
          $else:
            - rtgl-view#avatar-placeholder slot=avatar-slot wh=120 av=c ah=c bgc=bg bc=bo bw=xs br=md cur=p:
              - rtgl-text c=mu-fg s=sm: Click to Upload
