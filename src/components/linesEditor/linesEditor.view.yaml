elementName: rvn-lines-editor

propsSchema:
  type: object
  properties:
    lines:
      type: array
      items:
        type: object
        properties:
    selectedLineId:
      type: string

refs:
  container:
    eventListeners:
      keydown:
        handler: handleContainerKeyDown
  line-*:
    eventListeners:
      focus:
        handler: handleOnFocus
      blur:
        handler: handleLineBlur
      input:
        handler: handleOnInput
      # mousedown:
      #   handler: handleBlockMouseDown
      mouseup:
        handler: handleLineMouseUp
      # beforeinput:
      #   handler: handleBlockBeforeInput
      # compositionend:
      #   handler: handleBlockCompositionEnd
      # compositionstart:
      #   handler: handleBlockCompositionStart
      keydown:
        handler: handleLineKeyDown
  preview-*:
    eventListeners:
      contextmenu:
        handler: handlePreviewRightClick

styles:
  'div[contenteditable="true"]':
    font-size: 16px
    font-family: inherit
    line-height: 1.5
  'div[contenteditable="true"]:focus':
    outline: none

template:
  - $if ready:
      - 'rtgl-view#container w=f tabindex=0 style="outline: none;"':
          - $for line, i in lines:
              - 'rtgl-view d=h w=f style="background-color: ${line.backgroundColor};"':
                  - rtgl-view h=f w=32 ah=e mr=md pt=sm:
                      - rtgl-text s=sm c=${line.lineColor}: ${line.lineNumber}
                  - rtgl-view wh=16 br=f mr=md:
                      - $if line.characterFileId:
                          - rvn-file-image fileId=${line.characterFileId} w=16 h=16 br=f:
                  - rtgl-view d=h w=f:
                      - rtgl-view w=f:
                          - 'div#line-${line.id} style="width: 100%; padding-bottom: 4px;" contenteditable=true': ${line.dialogueText}
                          - $if line.sectionTransition:
                              - rtgl-view#preview-sectionTransition data-type="sectionTransition" data-id="${line.id}" d=h:
                                  - rtgl-svg svg="transition" wh=16:
                                  - rtgl-svg svg="section" wh=16:
                                  - rtgl-text s=sm: "Transition to section: ${line.transitionTarget}"
                          - $if line.hasChoices:
                              - rtgl-view#preview-choice data-type="choice" data-id="${line.id}" d=v:
                                  - rtgl-view d=h:
                                      - rtgl-svg svg="choices" wh=16:
                                      - rtgl-text s=sm: "Choices:"
                                  - $for choice in line.choices:
                                      - rtgl-view d=h ml=sm:
                                          - rtgl-text s=sm: "â€¢ ${choice.content}"

                      - rtgl-view d=h:
                          - $if line.background:
                              - rtgl-view#preview-background data-type="background" data-id="${line.id}":
                                  - $if line.background.fileId:
                                      - rvn-file-image w=36 h=24 fileId=${line.background.fileId} mr=sm:
                                    $else:
                                      - rtgl-svg svg=image wh=24:
                          - $if line.characterSprites:
                              - rtgl-view#preview-character data-type="character" data-id="${line.id}":
                                  - $if line.characterSprites.length > 0:
                                      - rtgl-view d=h mr=sm:
                                          - $for sprite in line.characterSprites:
                                              - rvn-file-image fileId=${sprite.fileId} w=20 h=24 br=f:
                                    $else:
                                      - rtgl-svg svg=character wh=24:
                          - $if line.hasDialogueLayout:
                              - rtgl-svg#preview-dialogue data-type="dialogue" data-id="${line.id}" svg="dialogue" wh=24 mr=sm:
                          - $if line.hasBase:
                              - rtgl-svg#preview-base data-type="base" data-id="${line.id}" svg="screen" wh=24 mr=sm:
                          - $if line.bgm:
                              - rtgl-svg#preview-bgm data-type="bgm" data-id="${line.id}" svg="music" wh=24 mr=sm:
                          - $if line.hasSfx:
                              - rtgl-svg#preview-sfx data-type="sfx" data-id="${line.id}" svg="audio" wh=24:
