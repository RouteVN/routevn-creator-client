elementName: rvn-lines-editor

handleBeforeMountviewDataSchema:
  type: object
  properties:
    selectedLineId:
      type: string
    mode:
      type: string

propsSchema:
  type: object
  properties:
    lines:
      type: array
      items:
        type: object
        properties:
    selectedLineId:
      type: string

refs:
  container:
    eventListeners:
      keydown:
        handler: handleContainerKeyDown
  line-*:
    eventListeners:
      focus:
        handler: handleOnFocus
      blur:
        handler: handleLineBlur
      input:
        handler: handleOnInput
      # mousedown:
      #   handler: handleBlockMouseDown
      mouseup:
        handler: handleLineMouseUp
      # beforeinput:
      #   handler: handleBlockBeforeInput
      # compositionend:
      #   handler: handleBlockCompositionEnd
      # compositionstart:
      #   handler: handleBlockCompositionStart
      keydown:
        handler: handleLineKeyDown

styles:
  'div[contenteditable="true"]':
    font-size: 16px
    font-family: inherit
    line-height: 1.5
  'div[contenteditable="true"]:focus':
    outline: none

template:
  - $if ready:
      - 'rtgl-view#container w=f h=f tabindex=0 style="outline: none;"':
          - $for line, i in lines:
              - 'rtgl-view d=h w=f style="background-color: ${line.backgroundColor};"':
                  - rtgl-view h=f w=32 ah=e mr=md pt=sm:
                      - rtgl-text s=sm c=${line.lineColor}: ${line.lineNumber}
                  - rtgl-view wh=16 br=f mr=md:
                      - $if line.characterFileId:
                          - rvn-file-image fileId=${line.characterFileId} w=16 h=16 br=f:
                  - rtgl-view d=h w=f:
                      - rtgl-view w=f:
                          - 'div#line-${line.id} style="width: 100%; padding-bottom: 4px;" contenteditable=true': ${line.presentation.dialogue.content[0].text}
                          - $if line.sceneTransition:
                              - rtgl-view d=h:
                                  - rtgl-svg svg="transition" wh=16:
                                  - rtgl-svg svg="scene" wh=16:
                                  - rtgl-text s=sm: "Transition to scene: ${line.transitionTarget}"
                          - $if line.sectionTransition:
                              - rtgl-view d=h:
                                  - rtgl-svg svg="transition" wh=16:
                                  - rtgl-svg svg="section" wh=16:
                                  - rtgl-text s=sm: "Transition to section: ${line.transitionTarget}"
                          - $if line.hasChoices:
                              - rtgl-view d=v:
                                  - rtgl-view d=h:
                                      - rtgl-svg svg="choices" wh=16:
                                      - rtgl-text s=sm: "Choices:"
                                  - $for choice in line.choices:
                                      - rtgl-view d=h ml=sm:
                                          - rtgl-text s=sm: "â€¢ ${choice.content}"

                      - rtgl-view d=h:
                          - $if line.backgroundFileId:
                              - rvn-file-image w=36 h=24 fileId=${line.backgroundFileId} mr=sm:
                          - $if line.characterSprites.length > 0:
                              - rtgl-view d=h mr=sm:
                                  - $for sprite in line.characterSprites:
                                      - rvn-file-image fileId=${sprite.fileId} w=20 h=24 br=f:
                          - $if line.hasDialogueLayout:
                              - rtgl-svg svg="dialogue" wh=24 mr=sm:
                          - $if line.hasBgm:
                              - rtgl-svg svg="music" wh=24 mr=sm:
                          - $if line.hasSfx:
                              - rtgl-svg svg="audio" wh=24:
