elementName: rvn-command-line-bgm

viewDataSchema:
  type: object
  properties:
    mode:
      type: string
      enum: ["current", "gallery"]
    items:
      type: array
    groups:
      type: array
    loopOptions:
      type: array
      items:
        type: object
        properties:
          label:
            type: string
          value:
            type: string
    tempSelectedResourceId:
      type: string
    breadcrumb:
      type: array
      items:
        type: object
        properties:
          id:
            type: string
          label:
            type: string
    form:
      type: object
    defaultValues:
      type: object
      properties:
        audio:
          type: string
        loopType:
          type: string
    context:
      type: object
      properties:
        audio:
          type: object
          properties:
            waveformData:
              type: string

propsSchema:
  type: object
  properties:
    line:
      type: object
      properties:
        presentation:
          type: object
          properties:
            bgm:
              type: object
              properties:
                resourceId:
                  type: string
                resourceType:
                  type: string
                  enum: ["audio"]
                loopType:
                  type: string

refs:
  form:
    eventListeners:
      extra-event:
        handler: handleFormExtra
      form-change:
        handler: handleFormChange
  base-file-explorer:
    eventListeners:
      click-item:
        handler: handleFileExplorerItemClick
  resource-item-*:
    eventListeners:
      click:
        handler: handleResourceItemClick
  submit-button:
    eventListeners:
      click:
        handler: handleSubmitClick
  reset-button:
    eventListeners:
      click:
        handler: handleResetClick
  breadcumb:
    eventListeners:
      item-click:
        handler: handleBreadcumbActionsClick
  button-select:
    eventListeners:
      click:
        handler: handleButtonSelectClick

template:
  - rtgl-view w=f h=f p=lg:
      - $if mode == 'current':
          - rtgl-view d=h g=md:
          - rtgl-breadcrumb#breadcumb .items=breadcrumb:
          
          - rtgl-form#form .form=form .defaultValues=defaultValues .context=context:
          
          - rtgl-view flex=1:
          - rtgl-view d=h av=c ah=e w=f g=lg:
              - rtgl-button#reset-button v=ol: Reset
              - rtgl-button#submit-button: Submit

      - $if mode == 'gallery':
          - rtgl-view d=h g=md:
              - rtgl-breadcrumb#breadcumb .items=breadcrumb:
          - 'rtgl-view d=h w=f g=lg style="min-height: 0;"':
              - rtgl-view h=f flex=1 sv:
                  - rvn-base-file-explorer#base-file-explorer .items=items:
              - rtgl-view h=f flex=2 sv g=lg:
                  - $for group in groups:
                      - rtgl-view g=md:
                          - rtgl-text: ${group.name}
                          - rtgl-view d=h w=f fw=w g=lg:
                              - $for item in group.children:
                                  - rtgl-view#resource-item-${item.id} cur=p style="${item.selectedStyle}":
                                      - $if item.waveformDataFileId:
                                          - rtgl-view:
                                              - rvn-waveform-visualizer waveformDataFileId=${item.waveformDataFileId} width=225 height=150:
                                              - rtgl-text w=225 ellipsis=true mt=sm: ${item.name}
                                        $else:
                                          - rtgl-view w=225 h=150 av=c ah=c bgc=ac:
                                              - rtgl-text s=sm c=mu-fg: No waveform
          - rtgl-view d=h av=c ah=e w=f g=lg:
              - rtgl-button#button-select: Select
