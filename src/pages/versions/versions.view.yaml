elementName: rvn-versions

viewDataSchema:
  type: object
  properties:
    versions:
      type: array
      default: []
    showVersionForm:
      type: boolean
      default: false
    versionFormFields:
      type: object
      default: {}

refs:
  left-panel:
    eventListeners:
      data-changed:
        handler: handleDataChanged
  save-version-btn:
    eventListeners:
      click:
        handler: handleSaveVersionClick
  version-form:
    eventListeners:
      action-click:
        handler: handleVersionFormAction
  version-form-popover:
    eventListeners:
      close:
        handler: handleVersionFormClose
  version-*:
    eventListeners:
      contextmenu:
        handler: handleVersionContextMenu
  dropdown-menu:
    eventListeners:
      close:
        handler: handleDropdownMenuClose
      click-item:
        handler: handleDropdownMenuClickItem

template:
  - rtgl-view d=h w=f h=f:
      - rvn-resizable-panel#file-explorer w=300 min-w=200 max-w=500 resize-side="right":
          - rtgl-view slot="content" w=f h=f:
              - rvn-resource-types .resourceCategory=resourceCategory .selectedResourceId=selectedResourceId:
            # - rvn-file-explorer#fileexplorer .items=flatItems .repositoryTarget=repositoryTarget:
      # - rvn-resizable-panel#left-panel .resourceCategory=resourceCategory .selectedResourceId=selectedResourceId .flatItems=flatItems .repositoryTarget=repositoryTarget:
      - rtgl-view flex=1 p=lg d=v g=lg:
          - rtgl-text s=h2: Versions
          - rtgl-button#save-version-btn v=pr s=md: Save
          - rtgl-view w=f g=md flex=1 oy=a:
              - $if versions.length == 0:
                  - rtgl-view w=f h=200 ah=c av=c:
                      - rtgl-view d=v ah=c g=md:
                          - rtgl-text s=lg c=mu-fg: No versions saved yet
                          - rtgl-text s=sm c=mu-fg: Save your first version to track changes
                $else:
                  - $for item in versions:
                      - rtgl-view#version-${item.id} h=auto w=f bw=xs p=md cur=p d=h av=c:
                          - rtgl-view flex=1 d=v g=xs:
                              - rtgl-text s=lg: ${item.name}
                              - rtgl-text s=xs c=mu-fg: "Action ${item.actionIndex} â€¢ ${item.createdAt}"
      - rtgl-popover#version-form-popover ?open=${showVersionForm} x=300 y=100:
          - rtgl-form#version-form key=${showVersionForm} slot=content .form=versionFormFields w=320:

  - rtgl-dropdown-menu#dropdown-menu ?open=${dropdownMenu.isOpen} x=${dropdownMenu.x} y=${dropdownMenu.y} .items=dropdownMenu.items:

