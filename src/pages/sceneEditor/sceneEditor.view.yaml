elementName: rvn-scene-editor

viewDataSchema:
  type: object
  properties:
    currentLines:
      type: array
      items:
        type: object
        properties:
          id:
            type: string

refs:
  lines-editor:
    eventListeners:
      editor-data-changed:
        handler: handleEditorDataChanged
      newLine:
        handler: handleNewLine
      splitLine:
        handler: handleSplitLine
      line-navigation:
        handler: handleLineNavigation
      mergeLines:
        handler: handleMergeLines
      delete-action:
        handler: handleLineDeleteActionItem
  section-tab-*:
    eventListeners:
      click:
        handler: handleSectionTabClick
      contextmenu:
        handler: handleSectionTabRightClick
  section-add:
    eventListeners:
      click:
        handler: handleSectionAddClick
  dropdown-menu:
    eventListeners:
      close:
        handler: handleDropdownMenuClickOverlay
      click-item:
        handler: handleDropdownMenuClickItem
  popover:
    eventListeners:
      close:
        handler: handlePopoverClickOverlay
  form:
    eventListeners:
      action-click:
        handler: handleFormActionClick
  add-actions-button:
    eventListeners:
      click:
        handler: handleAddActionsButtonClick
  toggle-sections-graph-view:
    eventListeners:
      click:
        handler: handleToggleSectionsGraphView
  actions-dialog:
    eventListeners:
      close:
        handler: handleActionsDialogClose
  system-actions:
    eventListeners:
      submit:
        handler: handleCommandLineSubmit
      action-delete:
        handler: handleSystemActionsActionDelete
      actions-change:
        handler: handleCommandLineSubmit
  back-button:
    eventListeners:
      click:
        handler: handleBackClick
  preview-button:
    eventListeners:
      click:
        handler: handlePreviewClick
  vn-preview:
    eventListeners:
      close:
        handler: handleHidePreviewScene

template:
  - rtgl-view w=f h=f:
      - rtgl-view bwb=xs w=f h=48 av=c ph=sm d=h:
          - rtgl-button#back-button sq icon="chevronLeft" v="gh" mr=sm:
          - rtgl-view flex=1:
              - rtgl-text c=mu-fg: ${scene.name}
          - rtgl-view flex=1:
              - rtgl-button#preview-button: Preview
      - 'rtgl-view d=h w=f h=f flex=1 style="min-height: 0px"':
          - $if sectionsGraphView:
              - 'rtgl-view w="calc((100vw - 64px) / 2)"':
                  - rtgl-view d=h w=f:
                      - rtgl-view flex=1:
                      # Toggle graph view button - commented out for now
                      # - rtgl-view#toggle-sections-graph-view h=32 av=c ph=lg ah=c bw=sm cur=p:
                      #     - rtgl-text s=sm: "<>"
                  - rtgl-view:
                      - rtgl-text: ${sectionsGraph}
            $else:
              - 'rtgl-view w=h h=f style="min-height: 0px"':
                  - 'rtgl-view d=h g=xs w="calc((100vw - 64px) / 2)"':
                      - rtgl-view d=h sh:
                          - rtgl-view d=h g=xs:
                              - $for section in sections:
                                  - rtgl-view#section-tab-${section.id} w=120 h=32 av=c ph=lg ah=c bgc=${section.bgc} cur=p:
                                      - rtgl-text s=sm: ${section.name}
                      - rtgl-view#section-add h=32 av=c ph=lg ah=c cur=p bgc=mu:
                          - rtgl-text s=sm: +

                      - rtgl-view flex=1:
                      # Toggle graph view button - commented out for now
                      # - rtgl-view#toggle-sections-graph-view h=32 av=c ph=lg ah=c bw=sm cur=p:
                      #     - rtgl-text s=sm: "<>"
                  - "rtgl-view w=f p=md sv":
                      - rvn-lines-editor#lines-editor .lines=currentLines .selectedLineId=selectedLineId:
                      - rtgl-view h=30vh:
          - rtgl-view w=1 h=f bgc=mu:
          - rtgl-view w=f:
              - rtgl-view:
                  - rtgl-view w=700 h=400 bgc=fg:
                      - 'div#canvas id=canvas style="width: 100%; height: 100%;display: flex;"':
              - rtgl-view w=f h=1 bgc=mu:
              - rtgl-view w=f m=md:
                  - rtgl-view d=h av=c:
                      - rtgl-text s=sm c=mu-fg: State
                  - rtgl-view g=md w=f pv=md:
                      - rvn-system-actions#system-actions show-selected .actions=selectedLineActions .selectedLineId=selectedLineId .selectedLine=selectedLine .currentSceneId=scene.id action-type="presentation" .presentationState=presentationState:
  - rtgl-dropdown-menu#dropdown-menu .items=dropdownMenu.items x=${dropdownMenu.position.x} y=${dropdownMenu.position.y} ?open=${dropdownMenu.isOpen}:
  - rtgl-popover#popover ?open=${popover.isOpen} x=${popover.position.x} y=${popover.position.y}:
      - rtgl-form#form slot=content .form=form:
  - $if previewVisible:
      - rvn-vn-preview#vn-preview scene-id="${previewSceneId}":
