elementName: rvn-scene-editor

viewDataSchema:
  type: object
  properties:
    currentLines:
      type: array
      items:
        type: object
        properties:
          id:
            type: string

refs:
  lines-editor:
    eventListeners:
      editor-data-changed:
        handler: handleEditorDataChanged
      newLine:
        handler: handleNewLine
      splitLine:
        handler: handleSplitLine
      line-navigation:
        handler: handleLineNavigation
      mergeLines:
        handler: handleMergeLines
      delete-action:
        handler: handleLineDeleteActionItem
  section-tab-*:
    eventListeners:
      click:
        handler: handleSectionTabClick
      contextmenu:
        handler: handleSectionTabRightClick
  section-add:
    eventListeners:
      click:
        handler: handleSectionAddClick
  sections-overview:
    eventListeners:
      click:
        handler: handleSectionsOverviewClick
  sections-overview-close:
    eventListeners:
      click:
        handler: handleSectionsOverviewClose
  section-overview-row-*:
    eventListeners:
      click:
        handler: handleSectionsOverviewRowClick
  dropdown-menu:
    eventListeners:
      close:
        handler: handleDropdownMenuClickOverlay
      click-item:
        handler: handleDropdownMenuClickItem
  popover:
    eventListeners:
      close:
        handler: handlePopoverClickOverlay
  form:
    eventListeners:
      action-click:
        handler: handleFormActionClick
  add-actions-button:
    eventListeners:
      click:
        handler: handleAddActionsButtonClick
  toggle-sections-graph-view:
    eventListeners:
      click:
        handler: handleToggleSectionsGraphView
  actions-dialog:
    eventListeners:
      close:
        handler: handleActionsDialogClose
  system-actions:
    eventListeners:
      submit:
        handler: handleCommandLineSubmit
      action-delete:
        handler: handleSystemActionsActionDelete
      actions-change:
        handler: handleCommandLineSubmit
  back-button:
    eventListeners:
      click:
        handler: handleBackClick
  preview-button:
    eventListeners:
      click:
        handler: handlePreviewClick
  mute-toggle:
    eventListeners:
      click:
        handler: handleMuteToggle
  vn-preview:
    eventListeners:
      close:
        handler: handleHidePreviewScene

template:
  - rtgl-view w=f h=f:
      - rtgl-view bwb=xs w=f h=48 av=c ph=sm d=h:
          - rtgl-button#back-button sq icon="chevronLeft" v="gh" mr=sm:
          - rtgl-view flex=1:
              - rtgl-text c=mu-fg: ${scene.name}
          - rtgl-view flex=1 d=h g=sm jc=e:
              - rtgl-button#preview-button: Preview
          - rtgl-button#mute-toggle sq v="gh" icon="${muteIcon}":
      - 'rtgl-view d=h w=f h=f flex=1 style="min-height: 0px"':
          - $if sectionsGraphView:
              - 'rtgl-view w="calc((100vw - 64px) / 2)"':
                  - rtgl-view d=h w=f:
                      - rtgl-view flex=1:
                      # Toggle graph view button - commented out for now
                      # - rtgl-view#toggle-sections-graph-view h=32 av=c ph=lg ah=c bw=sm cur=p:
                      #     - rtgl-text s=sm: "<>"
                  - rtgl-view:
                      - rtgl-text: ${sectionsGraph}
            $else:
              - $if sectionsOverviewOpen:
                  - 'rtgl-view#scene-editor-left-overview w="calc((100vw - 64px) / 2)" d=v h=f style="min-height: 0px"':
                      - rtgl-view d=h av=c g=sm bwb=xs p=lg w=f:
                          - rtgl-text s=lg fw=600: Sections Overview
                          - rtgl-view flex=1:
                          - rtgl-button#sections-overview-close v=gh: Close
                      - 'rtgl-view d=v w=f flex=1 sv p=md g=sm style="min-height: 0px;"':
                          - $for section in sectionsOverviewItems:
                              - rtgl-view#section-overview-row-${section.id} w=f d=h av=c g=sm p=md cur=p bw=xs bc=${section.rowBc} bgc=${section.rowBgc} br=sm h-bgc=mu:
                                  - 'rtgl-text s=md c=${section.rowTextColor} style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"': ${section.name}
                $else:
                  - 'rtgl-view#scene-editor-left-editor w="calc((100vw - 64px) / 2)" d=v h=f style="min-height: 0px"':
                      - 'rtgl-view d=h g=xs w=f':
                          - rtgl-view d=h sh:
                              - rtgl-view d=h g=xs:
                                  - $for section in sections:
                                      - rtgl-view#section-tab-${section.id} w=120 h=32 av=c ph=lg ah=c bgc=${section.bgc} cur=p:
                                          - rtgl-text s=sm: ${section.name}
                          - rtgl-view#section-add h=32 av=c ph=lg ah=c cur=p bgc=mu:
                              - rtgl-text s=sm: +
                          - rtgl-view#sections-overview h=32 av=c ph=lg ah=c cur=p bgc=mu:
                              - rtgl-text s=sm: ...

                          - rtgl-view flex=1:
                          # Toggle graph view button - commented out for now
                          # - rtgl-view#toggle-sections-graph-view h=32 av=c ph=lg ah=c bw=sm cur=p:
                          #     - rtgl-text s=sm: "<>"
                      - "rtgl-view w=f p=md sv flex=1":
                          - rvn-lines-editor#lines-editor .lines=currentLines .selectedLineId=selectedLineId .sectionLineChanges=sectionLineChanges:
                          - rtgl-view h=30vh:
          - rtgl-view w=1 h=f bgc=mu:
          - rtgl-view w=f:
              - rtgl-view:
                  - rtgl-view w=700 h=400 bgc=fg:
                      - 'div#canvas id=canvas style="width: 100%; height: 100%;display: flex;"':
              - rtgl-view w=f h=1 bgc=mu:
              - rtgl-view w=f m=md:
                  - rtgl-view d=h av=c:
                      - rtgl-text s=sm c=mu-fg: State
                  - rtgl-view g=md w=f pv=md:
                      - rvn-system-actions#system-actions show-selected .actions=selectedLineActions .selectedLineId=selectedLineId .selectedLine=selectedLine .currentSceneId=scene.id action-type="presentation" .presentationState=presentationState:
  - rtgl-dropdown-menu#dropdown-menu .items=dropdownMenu.items x=${dropdownMenu.position.x} y=${dropdownMenu.position.y} ?open=${dropdownMenu.isOpen}:
  - rtgl-popover#popover ?open=${popover.isOpen} x=${popover.position.x} y=${popover.position.y}:
      - rtgl-form#form slot=content .form=form:
  - $if previewVisible:
      - rvn-vn-preview#vn-preview scene-id="${previewSceneId}" section-id="${previewSectionId}" line-id="${previewLineId}":
