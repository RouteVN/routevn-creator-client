elementName: rvn-scenes

viewDataSchema:
  type: object
  properties: {}

refs:
  fileexplorer:
    eventListeners:
      data-changed:
        handler: handleDataChanged
  whiteboard:
    eventListeners:
      item-position-changed:
        handler: handleWhiteboardItemPositionChanged
      item-position-updating:
        handler: handleWhiteboardItemPositionUpdating
      item-selected:
        handler: handleWhiteboardItemSelected
      item-double-click:
        handler: handleWhiteboardItemDoubleClick
      canvas-click:
        handler: handleWhiteboardClick
      canvas-context-menu:
        handler: handleWhiteboardCanvasContextMenu
      item-delete:
        handler: handleWhiteboardItemDelete
      item-context-menu:
        handler: handleWhiteboardItemContextMenu
      zoom-changed:
        handler: handleWhiteboardZoomChanged
      pan-changed:
        handler: handleWhiteboardPanChanged
  add-scene-btn:
    eventListeners:
      click:
        handler: handleAddSceneClick
  detail-form:
    eventListeners:
      form-change:
        handler: handleFormChange
  sections-panel-toggle:
    eventListeners:
      click:
        handler: handleSectionsPanelToggle
  section-row-*:
    eventListeners:
      click:
        handler: handleSectionRowClick
  scene-form:
    eventListeners:
      action-click:
        handler: handleSceneFormAction
  scene-form-popover:
    eventListeners:
      close:
        handler: handleSceneFormClose
  dropdown-menu:
    eventListeners:
      close:
        handler: handleDropdownMenuClose
      click-item:
        handler: handleDropdownMenuClickItem
  preview-button:
    eventListeners:
      click:
        handler: handleClickShowScenePreview
  vn-preview:
    eventListeners:
      close:
        action: hidePreviewScene

template:
  - rtgl-view d=h w=f h=f:
      - rtgl-view d=h h=f w=f:
          - rvn-resizable-panel#file-explorer w=300 min-w=200 max-w=500 resize-side="right":
              - rtgl-view slot="content" w=f h=f:
                  - rtgl-text ml=lg s=sm c=mu-fg mv=md: Scenes
                  - rvn-resource-types .resourceCategory=resourceCategory .selectedResourceId=selectedResourceId:
                  - rvn-file-explorer#fileexplorer .items=flatItems .repositoryTarget=repositoryTarget:
          - rtgl-view flex=1 h=f:
              - rvn-whiteboard#whiteboard .items=whiteboardItems .cursor=whiteboardCursor .selectedItemId=selectedItemId:
          - rvn-resizable-panel panel-type=detail-panel w=400 min-w=320 max-w=620 resize-side="left":
              - rtgl-view wh=f d=v slot="content":
                  - $if selectedItemId:
                      - 'rtgl-view w=f h=f d=v g=sm style="min-height: 0px;"':
                          - rtgl-form#detail-form key=${selectedItemId} w=f .form=form .defaultValues=defaultValues:
                              - rtgl-button#preview-button slot="preview" data-scene-id="${selectedItemId}": Preview
                          - 'rtgl-view w=f flex=1 d=v bw=xs br=md bgc=bg style="min-height: 0px;"':
                              - rtgl-view#sections-panel-toggle w=f d=v g=md p=lg cur=p h-bgc=mu bw=xs br=sm bgc=bg:
                                  - rtgl-view w=f d=h av=c:
                                      - rtgl-text s=md fw=600: Sections Overview
                                      - rtgl-view flex=1:
                                      - rtgl-view ph=md pv=xs bgc=ac bw=xs bc=ac br=full:
                                          - rtgl-text s=xs fw=600 c=bg: ${sectionsPanelToggleLabel}
                                  - rtgl-view w=f d=h g=md:
                                      - 'rtgl-view flex=1 h=72 d=v jc=sb p=md bw=xs bc=mu br=sm bgc=mu style="min-width: 0px;"':
                                          - rtgl-text s=sm c=mu-fg: Sections
                                          - rtgl-text s=lg: ${sectionCount}
                                      - 'rtgl-view flex=1 h=72 d=v jc=sb p=md bw=xs bc=mu br=sm bgc=mu style="min-width: 0px;"':
                                          - rtgl-text s=sm c=mu-fg: Dead Ends
                                          - rtgl-text s=lg: ${deadEndCount}
                                      - 'rtgl-view flex=1 h=72 d=v jc=sb p=md bw=xs bc=mu br=sm bgc=mu style="min-width: 0px;"':
                                          - rtgl-text s=sm c=mu-fg: Initial
                                          - $if initialSectionName:
                                              - 'rtgl-text s=md style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"': ${initialSectionName}
                                            $else:
                                              - rtgl-text s=md c=mu-fg: None
                              - $if sectionsPanelExpanded:
                                  - 'rtgl-view w=f flex=1 d=v p=sm g=sm style="min-height: 0px;"':
                                      - $if sectionCount == 0:
                                          - rtgl-view flex=1 av=c ah=c bw=xs br=sm bgc=mu:
                                              - rtgl-text s=sm c=mu-fg: No sections
                                        $else:
                                          - 'rtgl-view w=f flex=1 sv d=v p=sm g=md bgc=bg bw=xs br=sm style="min-height: 0px;"':
                                              - $for section in sectionCards:
                                                  - rtgl-view#section-row-${section.id} w=f d=v g=md p=lg cur=p bw=xs bc=mu br=sm bgc=bg h-bgc=mu:
                                                      - rtgl-view d=h w=f av=c g=sm:
                                                          - 'rtgl-view d=h av=c g=sm flex=1 style="min-width: 0px;"':
                                                              - rtgl-text s=md fw=600: ${section.name}
                                                              - $if section.isMenuReturn:
                                                                  - rtgl-view ph=xs pv=xxs bgc=mu br=sm:
                                                                      - rtgl-text s=xs c=mu-fg: Menu End
                                                          - rtgl-view d=h av=c g=sm:
                                                              - rtgl-text s=xxs c=mu-fg: #${section.order}
                                                              - $if section.isDeadEnd:
                                                                  - rtgl-view ph=xs pv=xxs bgc=er br=sm:
                                                                      - rtgl-text s=xs c=bg: Dead End
                                                      - rtgl-view d=h g=md jc=c av=c:
                                                          - rtgl-view w=98 h=72 d=v jc=sb p=md bgc=mu bw=xs bc=mu br=sm:
                                                              - rtgl-text s=xs c=mu-fg: Lines
                                                              - rtgl-text s=md: ${section.lineCount}
                                                          - rtgl-view w=98 h=72 d=v jc=sb p=md bgc=mu bw=xs bc=mu br=sm:
                                                              - rtgl-text s=xs c=mu-fg: Choices
                                                              - rtgl-text s=md: ${section.choiceCount}
                                                          - rtgl-view w=98 h=72 d=v jc=sb p=md bgc=mu bw=xs bc=mu br=sm:
                                                              - rtgl-text s=xs c=mu-fg: Outgoing
                                                              - rtgl-text s=md: ${section.outgoingCount}
                    $else:
                      - rtgl-view wh=f av=c ah=c bgc=mu-fg:
                          - rtgl-text s=md c=mu-fg: No selection
      - 'rtgl-view pos=abs z=100 ah=c p=md bgc=mu br=md style="left: 50%; transform: translateX(-50%); bottom: 20px;"':
          - rtgl-view d=h av=c:
              - 'rtgl-button#add-scene-btn ip="s" icon="plus" s=md v=${addSceneButtonVariant}': Add Scene
      - rtgl-popover#scene-form-popover ?open=${showSceneForm} x=${sceneFormPosition.x} y=${sceneFormPosition.y}:
          - rtgl-form#scene-form key=${showSceneForm} slot=content .form=sceneFormFields w=320:
      - rtgl-dropdown-menu#dropdown-menu .items=dropdownMenu.items x=${dropdownMenu.position.x} y=${dropdownMenu.position.y} ?open=${dropdownMenu.isOpen}:
  - $if previewVisible:
      - rvn-vn-preview#vn-preview scene-id="${previewSceneId}":
